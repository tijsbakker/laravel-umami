<p align="center"><img src="https://banners.beyondco.de/Laravel%20Umami.png?theme=light&packageManager=composer+require&packageName=still-code%2Flaravel-umami&pattern=brickWall&style=style_1&description=Umami+API+wrapper+for+laravel&md=1&showWatermark=1&fontSize=125px&images=chart-bar" width="600"></p>

<p align="center">
<a href="https://github.com/umami-software/umami"><img src="https://img.shields.io/github/package-json/v/umami-software/umami?color=white&logoColor=white&label=Umami&logo=data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAD2EAAA9hAHVrK90AAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm%2B48GgAACHVJREFUeJztnW9slVcdxz%2FnuaXl9nbWu39dppWlmW3JYk2k4htKbGsTkgEZOhY0VdRkyvQFBmFKzLSYmJnwwvhnBodxAbQhkYTI0khc1ipgX0ykSLewFqw0sauDwq6UCt3u7c8X52l3e3tve%2B%2Ft8%2BeUnk%2FyS9qn9znn93y%2FPed57vOccx4lIljMwQk7ActsrCGGYQ0xjJKwEygUpVQlUAvEgUrgHqACUMAt4KYbCWBQRN4JKdWiUCaf1JVSVUAzsB5YDdQDDxVYzDXgTeAicBroFpG3vMzTS4wzRCn1KeDzwGeAx3yq5k3gVeAo8FcxSAQjDFFKVQNfAr4I1AVc%2FT%2BBI8BhEflXwHXPRURCC6AG%2BBXwLiAhRwp4GVgTpiahtBCl1GpgH%2FA58rzSi0aj1NXVUVtbS21tLdXV1cTjcSoqKojFYiilmJiYYHx8nEQiwcjICAMDAwwODjIwMMDExES%2B6QlwAvi%2BiFwo6gAXQaCGKKXKgeeAXUDpfJ%2BNRqOsW7eO5uZmmpubaWxspKSkuIvCVCpFX18fPT099PT0cOrUqXwMSgK%2FAH4gIjeLqrgYAuyeNgFXmKfbUEpJU1OTHDx4UBKJhPjF%2BPi4HDp0SFpbW8VxnIW6shHgqcB08r0CKHP%2F03IedFlZmezYsUMuXbrktfYLMjw8LDt37pTy8vKFjHkJiHmhyXzhtxmPAn%2FPdZArV66UXbt2ycjIiA9SF8bVq1dl7969EovF5jPlDeAxWYqGAK3Af3Md3IYNG%2BTy5cu%2BiLsYhoeHZcuWLfOZMgFslqVkCLAVuJPtgKqqquTYsWM%2ByekdXV1dUl1dncuU94CvylIwBHgGfU0%2F50BaWlpkdHTUNxG9ZmxsTDZu3JjLlCngu2KyIcDTbqKzknccRzo6OiSZTPoonz9MTU3J%2Fv37paSkJJcxe8REQ4DNblOelXBpaal0dnb6KloQnDhxQqLRaK6W4ln35ZUZnwZuZyYbi8Xk5MmTPksVHKdPn5Z4PJ7rnPK4mGAIUA2MZSZZXl4uZ86c8V2koOnr65PKyspsptwEPiphGoJ%2BwHU6M7kVK1ZIV1dXAPKEQ29vb64vkheAqIRoyPOZSSml5PDhw0HoEirHjx%2BXSCSSzZQXJAxDgHXZLm93794diCAmsG%2FfvlxXXhskSEPcrup8ZiJr166VycnJgOQIn1QqJW1tbdkMuQyslAAN%2BXZmEvF4XK5cuRKUFsYwOjoqVVVV2UzpkCAMAR4GxjMTOHDgQGAimEZnZ2c2Q24DNRKAIT%2FJrLyxsVFSqVRwChhIS0tLNlMOip%2BGAA%2Bgxz7NVBqJROTs2bMBHrqZXLx4UUpLSzMNmQQ%2BIgVoXOjIxZ1ALH3D1q1bWbNmTYHF3H3U19ezffv2zM2lwJ5Cysn7mbr7PHwE%2BGDaNs6fP09DQ0Mhdd61DA0NUVdXRzKZTN98G%2FiwiNzIp4xCWsgTpJkBsGnTJmtGGjU1NWzbti1zcxR4Ku9C8u3bgD%2BScdLq7u4OsJdeGpw7dy7byb1X8tQ5ry7LHWP7b9IGZ69atYqhoSEcxw6gz6ShoYH%2B%2Fv7MzXUiMrjQvvmq%2BSQZI%2BXb29utGTlob2%2FPtvnJfPadJbJS6iGgPMvnNmduWL9%2BPUNDQ%2FnUsexoampCKUVG7%2FO4Uupolo%2FfkfTR%2BO5O29FXULlultnwN94GnhERFPq%2F%2Fw9ZnLMEz5cjwEFgVdiZWACoUcBV9C0RS%2FgkHZbgPMO7mBJ73WoY1hDDcIAVYSdheR%2BHBWYyWYLFASJhJ2F5Hwf4X9hJWGZIOehHshYzeMdBjyCxmMGYNcQsrjvoeYAWM7jhoNf6sJjBNQcYCDsLywwD1hCzeN0aYhb9Cn37%2FSZ6%2FJAlPBLAvY6IJIHesLOxcEFEZPr2%2B5%2FDzMQC6CUHZ56HdIeYiEVzEtzB1kqpEuA68IFwc1q2XAceFJEpB8A9j9hWEh6viMgUzH6E%2B9uQkrGkjYubGWytlCoF3gLuCymp5coN4EMicgfSWoiIvAv8PqysljG%2FmzYD5o46ORJwMhb4TfovswwRkV7gb4Gms7w5KyLn0zdkG5f1o4CSsei1YmYxZwaVUkoB%2FwA%2BFlBSy5XXgY9PX%2B5OM6eFiHZojnMWz3ku0wzIMS1aKRUBzgF2iq0%2F9KEX%2FZ8jftaxvSKSAr6Bnt1j8RYBdmczQ%2F91%2FqnQLxH%2BdK%2B7LX5d9LRopdR96CeK9tu7N4wBq0VkLNcH5p2OICLXgWe9zmoZ8635zADm77LSuq4jhN%2FUl3oc9XIlhwr0N%2Fj6BT9sycYg8EnJ48Uwec2gEpFb6AVUbi8yseXIBPDZfMyAAqa0iUg%2F8HV087PkhwBPi8gb%2Be9R%2BBJ%2Fewi%2FP14q8WzB%2Bha6g2vKfgMO1vR4vihtizREAYcMOGhT40Xc21KBGOKaEgF%2BacDBmxYvApGidS12xzRjvmOACKbEjxet52ILcE35Clle5rKMIgl8zRMtvSjENaUNve5T2OIEHW8DbZ7p6FVBrikPAn8yQKSgoht42FMNvSzMNSUC%2FBDdjMMWzK94D%2Fge4Hiun9cFphnTCLxmgHhex2vo%2B1L%2B6OZXwa4pCv3i%2BmsGCLnYuI5ear3oS9rQDUkz5gHg52R5k9sSiNvAz4B7A9EqiEoyjOlAT98KW%2BiFYhz4KXrcbWAaBfqC%2B2ncR8PfRH9%2FeSTwBOZnGL0w6Asikgi68lAMmZWAUmvQ55kvAPeHlEYCeBk4DLwqIYoSuiHTKKVWol%2F53Qo0o8eE%2BbUE4RTQD%2FSg5%2Fa9IiKTPtVVEMYYkolS6n70K10%2FAdS58ShQVmBRk%2Bi3pg0Al9CXrX8RPYDDOIw1JBvuiMpH0HcEKtDvM7nH%2FRn02l%2Fj6AV1bgH%2FAYZFD%2FxbEiwpQ5YDdplYw7CGGIY1xDD%2BD5eOJyTdi6OvAAAAAElFTkSuQmCC" /></a>
<a href="https://packagist.org/packages/still-code/laravel-umami"><img src="https://img.shields.io/packagist/v/still-code/laravel-umami" /></a>
<a href="https://packagist.org/packages/still-code/laravel-umami"><img src="https://img.shields.io/packagist/dt/still-code/laravel-umami" /></a>
<a href="https://github.com/still-code/laravel-umami"><img src="https://img.shields.io/github/stars/still-code/laravel-umami" /></a>
<a href="https://github.com/still-code/laravel-umami/actions?query=workflow%3AFix+PHP+code+style+issues+branch%3Amain"><img src="https://img.shields.io/github/actions/workflow/status/still-code/laravel-umami/fix-php-code-style-issues.yml?branch=main&label=code%20style" /></a>
<a href="https://github.com/still-code/laravel-umami/actions/workflows/fix-php-code-style-issues.yml"><img src="https://github.com/still-code/laravel-umami/actions/workflows/fix-php-code-style-issues.yml/badge.svg" /></a>
</p>

# Umami API wrapper for laravel

API wrapper for umami website analytics. get your statistics in the laravel app.

check out [Umami](https://umami.is/), own your website analytics

## Features

- Manage websites
- Manage users
- query statistics stats, page views, events and metrics

## Installation

You can install the package via composer:

```bash
composer require still-code/laravel-umami
```

#### Umami version:

- for umami v1 use v4
- for umami v2 use v5

### Config
to publish the configuration file:

```bash
php artisan vendor:publish --provider="Umami\UmamiServiceProvider"
```

and then add these to your `.env` file:

```bash
UMAMI_URL=https://stats-site-com/api
UMAMI_USERNAME=username
UMAMI_PASSWORD="password"
UMAMI_WEBSITE_ID=d131d2ae-5d21-4a54-80ba-16719afedf7b
```

## Usage

### Query Stats
```php
\Umami\Umami::query('example-site-id', 'metrics', [
    'start_at'=>today()->subDays(7),
    'end_at'=>today(),
    'type'=>'referrer',
]);
```

<br>

short usage for `PHP 8` to get default stats for the last 7 days and without cache:
```php
\Umami\Umami::query(siteID: 1, force: true)
```

### Parameters

#### Site id

required: site id from umami server

```php
\Umami\Umami::query('example-site-id');
```

#### Part

required: the stats part you want to get from umami,

available options : `active, stats, pageviews, events, metrics`

default: `stats`

```php
\Umami\Umami::query('example-site-id','pageviews');
```

### Options for Query Stats

#### Dates (start_at,end_at)

optional: Timestamp of starting and end date,

default: last 7 days

you can pass `carbon` object or timestamp in milliseconds

```php
\Umami\Umami::query('example-site-id','metrics',[
    'start_at'=>today()->subDays(7),
    'end_at'=>now(),
]);
```

##### unit
only available on `pageviews` and `events`

optional: Time unit, available options: `year, month, hour, day`,

default: day

```php
\Umami\Umami::query('example-site-id','metrics',[
    'unit'=>'year',
]);
```

##### Timezone (tz)
optional: Timezone,

only available on `pageviews` and `events`

default: config('app.timezone')

```php
\Umami\Umami::query('example-site-id','metrics',[
    'tz'=>'America/Los_Angeles',
]);
```

##### type (for metrics only)

optional: Gets metrics for a given time range,

available options: `url, referrer, browser, os, device, country, event`,

default: url

```php
\Umami\Umami::query('example-site-id','metrics',[
    'tz'=>'America/Los_Angeles',
]);
```

## Websites

### Get All websites

```php
\Umami\Umami::websites();
```

### Create a website

```php
\Umami\Umami::createWebsite([
    'domain'=>'domain.ltd',
    'name'=>'user name',
]);
```

#### create a website for a diffrent user
If you want to create a website for different user then the admin user defined in the config, you need to provide the authentication for that user.
this is helpful when creating a new user with a website

```php
\Umami\Umami::createWebsite([
    'domain' => 'domain.ltd',
    'name' => 'user name',
],[
    'username' => 'otherUserName',
    'password' => 'otherPassword',
]);
```

### Update a website

```php
\Umami\Umami::updateWebsites('example-site-id',[
    'name'=>'user name',
]);
```

### Delete a website

```php
\Umami\Umami::deleteWebsite('example-site-id');
```

## Event data

### Get website event and field key record counts within a given time range

See the API documentation for details: https://umami.is/docs/api/event-data#get-/api/event-data/events

```php
\Umami\Umami::events('example-site-id', [
    'start_at'=>today()->subDays(7),
    'end_at'=>now(),
    'event' => 'custom_event',
]);
```

### Get website field key and value record counts within a given time range

See the API documentation for details: https://umami.is/docs/api/event-data#get-/api/event-data/fields

```php
\Umami\Umami::event_fields('example-site-id', [
    'start_at'=>today()->subDays(7),
    'end_at'=>now(),
]);
```

## Users

### Get all users

```php
\Umami\Umami::users();
```

### Create a user

```php
\Umami\Umami::createUser('username','password');
```

### Update a user

```php
\Umami\Umami::updateUser(1,[
    'username'=>'username',
    'password'=>'password',
]);
```

### Delete a user

```php
\Umami\Umami::deleteUser(2);
```

## More details

Please check out [Umami website](https://umami.is/) for more information.

## Changelog

Please see [CHANGELOG](CHANGELOG.md) for more information what has changed recently.

## Contributing

Please see [CONTRIBUTING](CONTRIBUTING.md) for details.

## Credits

- [Mike Cao](https://github.com/mikecao)
- [All Contributors](../../contributors)

## License

The MIT License (MIT). Please see [License File](LICENSE.md) for more information.
